
{% extends "./coach_org/base.html" %}
{% block content %}
{{ block.super }}
<div class="page-header">
  <h1>
      个人中心 <small> <i class="ace-icon fa "></i>
      注册时间：{{coachorg.user.regist_time}}
    </small>
  </h1>
</div>
<!-- /.page-header -->

<div class="row">
  <div class="col-xs-12">
    <div>
      <div id="user-profile-3" class="user-profile row">
        <div class="col-sm-offset-1 col-sm-10">

          <div class="space"></div>

          <form class="form-horizontal">
            <div class="tabbable">
              <ul class="nav nav-tabs padding-16">
                <li class="active"><a data-toggle="tab"
                  href="#edit-basic"> <i
                    class="green ace-icon fa fa-pencil-square-o bigger-125"></i>
                  个人信息
                </a></li>

                <li><a data-toggle="tab" href="#edit-password"> <i
                    class="blue ace-icon fa fa-key bigger-125"></i> 密码修改
                </a></li>
              </ul>

              <div class="tab-content profile-edit-tab-content">
                <div id="edit-basic" class="tab-pane in active">
                  <h4 class="header blue bolder smaller">基本信息</h4>
                  <div class="row">
                    <div class="vspace-12-sm"></div>
                    <div class="col-xs-12 col-sm-8">
                      <div class="form-group">
                        <label class="col-sm-4 control-label no-padding-right"
                          for="form-field-orgnum">编号</label>
                        <div class="col-sm-8">
                          <div class="profile-info-value">
                            <span class="editable editable-click" id="orgnum">
                              {{coachorg.org_num}}</span>
                          </div>
                        </div>
                      </div>
                      <div class="space-4"></div>
                      <div class="form-group">
                        <label class="col-sm-4 control-label no-padding-right"
                          for="form-field-orgname">名称</label>
                        <div class="col-sm-8">
                          <div class="profile-info-value">
                            <span class="editable editable-click" id="orgname">{{coachorg.name}}</span>
                          </div>
                        </div>
                      </div>
                      <div class="space-4"></div>
                      <div class="form-group">
                        <label class="col-sm-4 control-label no-padding-right"
                          for="form-field-phone">电话</label>
                        <div class="col-sm-8">
                          <div class="profile-info-value">
                            <span class="editable editable-click" id="phone">
                              {{coachorg.user.phone}}
                            </span>
                          </div>
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="col-sm-4 control-label no-padding-right"
                          for="form-field-place">地址</label>
                        <div class="col-sm-8">
                          <div class="profile-info-value">
                            <span class="myeditable editable editable-click" id="province" name="province" data-type="select">{{coachorg.province}}</span>
                              省
                          </div>
                          <div class="profile-info-value">
                            <span class="myeditable editable editable-click" id="city" name="city" data-type="select">{{coachorg.city}}</span>
                                市
                          </div>
                          <div class="profile-info-value">
                            <span class="myeditable editable editable-click" id="dist" name="dist" data-type="select">{{coachorg.dist}}</span>
                                区/县
                          </div>
                          <div class="profile-info-value">
                              <span class="myeditable editable editable-click" id="address">{{coachorg.address}}</span>
                          </div>
                        </div>
                      </div>
                      <div class="space-4"></div>
                      <div class="form-group">
                        <label class="col-sm-4 control-label no-padding-right"
                          for="form-field-email">邮箱</label>
                        <div class="col-sm-8">
                          <div class="profile-info-value">
                            <span class="editable editable-click" id="email">{{coachorg.user.email}}</span>
                          </div>
                        </div>
                      </div>
                      <div class="space-4"></div>
                      <div class="form-group">
                        <label class="col-sm-4 control-label no-padding-right"
                          for="form-field-last_log">上次登录时间</label>
                        <div class="col-sm-8">
                          <div class="profile-info-value">
                            <span class="editable editable-click" id="last_log">{{coachorg.user.last_login}}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <hr />
                </div>
                <div id="edit-password" class="tab-pane">
                  <div class="space-10"></div>

                  <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right"
                      for="form-field-pass1">新密码</label>

                    <div class="col-sm-9">
                      <input type="password" id="form-field-pass1" />
                    </div>
                  </div>

                  <div class="space-4"></div>

                  <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right"
                      for="form-field-pass2">确认密码</label>

                    <div class="col-sm-9">
                      <input type="password" id="form-field-pass2" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="clearfix form-actions">
              <div class="col-md-offset-3 col-md-9">
                <button class="btn btn-info" type="button">
                  <i class="ace-icon fa fa-check bigger-110"></i> Save
                </button>

                &nbsp; &nbsp;
                <button class="btn" type="reset">
                  <i class="ace-icon fa fa-undo bigger-110"></i> Reset
                </button>
              </div>
            </div>
          </form>
        </div>
        <!-- /.span -->
      </div>
      <!-- /.user-profile -->
    </div>

    <!-- PAGE CONTENT ENDS -->
  </div>
  <!-- /.col -->
</div>
<!-- /.row -->
<!-- /.main-content -->
<a href="#" id="btn-scroll-up"
  class="btn-scroll-up btn btn-sm btn-inverse"> <i
    class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
</a>
  </div>
  <!-- /.main-container -->
{% endblock %}
{% block script %}
{{ block.super }}
  <script type="text/javascript">
    var scripts = [null,"http://sunny-sports.qiniudn.com/static/js/jquery-ui.custom.min.js","../../static/js/jquery.ui.touch-punch.min.js","../../static/js/jquery.gritter.min.js","../../static/js/bootbox.min.js","../../static/js/date-time/bootstrap-datepicker.min.js","../../static/js/jquery.hotkeys.min.js","../../static/js/select2.min.js","../../static/js/fuelux/fuelux.spinner.min.js","../../static/js/x-editable/bootstrap-editable.min.js","../../static/js/x-editable/ace-editable.min.js","../../static/js/jquery.maskedinput.min.js", null]
      ace.load_ajax_scripts(scripts, function() {
        //inline scripts related to this page
        jQuery(function($) {

          //editables on first profile page
          $.fn.editable.defaults.mode = 'inline';
          $.fn.editableform.loading = "<div class='editableform-loading'><i class='ace-icon fa fa-spinner fa-spin fa-2x light-blue'></i></div>";
          $.fn.editableform.buttons = '<button type="submit" class="btn btn-info editable-submit"><i class="ace-icon fa fa-check"></i></button>'+
            '<button type="button" class="btn editable-cancel"><i class="ace-icon fa fa-times"></i></button>';    

          //editables 

          //text editable
          $('#orgnum')
          .editable({
            type: 'text',
            name: 'orgnum'
          });
          $('#orgname')
          .editable({
            type: 'text',
            name: 'orgname'
          });        
          $('#email')
          .editable({
            type: 'text',
            name: 'email'
          });	
          $('#phone')
          .editable({
            type: 'text',
            name: 'phone'
          });	
           $('#province')
          .editable({
            name:'province'
          });
          $('#city')
          .editable({
            name:'city'
          });
          $('#dist')
          .editable({
           name:'dist'
          });
          $('#address')
          .editable({
            type:'text',
            name:'address'
          });

          //select2 editable
          // *** editable avatar *** //
          try {//ie8 throws some harmless exceptions, so let's catch'em

            //first let's add a fake appendChild method for Image element for browsers that have a problem with this
            //because editable plugin calls appendChild, and it causes errors on IE at unpredicted points
            try {
              document.createElement('IMG').appendChild(document.createElement('B'));
            } catch(e) {
              Image.prototype.appendChild = function(el){}
            }
          }catch(e) {}


          //another option is using modals
          $('#avatar2').on('click', function(){
            var modal = 
            '<div class="modal fade">\
              <div class="modal-dialog">\
              <div class="modal-content">\
              <div class="modal-header">\
              <button type="button" class="close" data-dismiss="modal">&times;</button>\
              <h4 class="blue">Change Avatar</h4>\
              </div>\
              \
              <form class="no-margin">\
              <div class="modal-body">\
              <div class="space-4"></div>\
              <div style="width:75%;margin-left:12%;"><input type="file" name="file-input" /></div>\
              </div>\
              \
              <div class="modal-footer center">\
              <button type="submit" class="btn btn-sm btn-success"><i class="ace-icon fa fa-check"></i> Submit</button>\
              <button type="button" class="btn btn-sm" data-dismiss="modal"><i class="ace-icon fa fa-times"></i> Cancel</button>\
              </div>\
              </form>\
              </div>\
              </div>\
              </div>';


            var modal = $(modal);
            modal.modal("show").on("hidden", function(){
              modal.remove();
            });

            var working = false;

            var form = modal.find('form:eq(0)');
            var file = form.find('input[type=file]').eq(0);
            file.ace_file_input({
              style:'well',
              btn_choose:'Click to choose new avatar',
              btn_change:null,
              no_icon:'ace-icon fa fa-picture-o',
              thumbnail:'small',
              before_remove: function() {
                //don't remove/reset files while being uploaded
                return !working;
              },
              allowExt: ['jpg', 'jpeg', 'png', 'gif'],
              allowMime: ['image/jpg', 'image/jpeg', 'image/png', 'image/gif']
            });

            form.on('submit', function(){
              if(!file.data('ace_input_files')) return false;

              file.ace_file_input('disable');
              form.find('button').attr('disabled', 'disabled');
              form.find('.modal-body').append("<div class='center'><i class='ace-icon fa fa-spinner fa-spin bigger-150 orange'></i></div>");

              var deferred = new $.Deferred;
              working = true;
              deferred.done(function() {
                form.find('button').removeAttr('disabled');
                form.find('input[type=file]').ace_file_input('enable');
                form.find('.modal-body > :last-child').remove();

                modal.modal("hide");

                var thumb = file.next().find('img').data('thumb');
                if(thumb) $('#avatar2').get(0).src = thumb;

                working = false;
              });


              setTimeout(function(){
                deferred.resolve();
              } , parseInt(Math.random() * 800 + 800));

              return false;
            });

          });



          //////////////////////////////
          $('#profile-feed-1').ace_scroll({
            height: '250px',
            mouseWheelLock: true,
            alwaysVisible : true
          });

          $('a[ data-original-title]').tooltip();

          $('.easy-pie-chart.percentage').each(function(){
            var barColor = $(this).data('color') || '#555';
            var trackColor = '#E2E2E2';
            var size = parseInt($(this).data('size')) || 72;
            $(this).easyPieChart({
              barColor: barColor,
              trackColor: trackColor,
              scaleColor: false,
              lineCap: 'butt',
              lineWidth: parseInt(size/10),
              animate:false,
              size: size
            }).css('color', barColor);
          });

          ///////////////////////////////////////////
/* ref by gll 20150205
          //right & left position
          //show the user info on right or left depending on its position
          $('#user-profile-2 .memberdiv').on('mouseenter touchstart', function(){
            var $this = $(this);
            var $parent = $this.closest('.tab-pane');

            var off1 = $parent.offset();
            var w1 = $parent.width();

            var off2 = $this.offset();
            var w2 = $this.width();

            var place = 'left';
            if( parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2) ) place = 'right';

            $this.find('.popover').removeClass('right left').addClass(place);
          }).on('click', function(e) {
            e.preventDefault();
          });
*/

          ///////////////////////////////////////////
          $('#user-profile-3')
          .find('input[type=file]').ace_file_input({
            style:'well',
            btn_choose:'Change avatar',
            btn_change:null,
            no_icon:'ace-icon fa fa-picture-o',
            thumbnail:'large',
            droppable:true,

            allowExt: ['jpg', 'jpeg', 'png', 'gif'],
            allowMime: ['image/jpg', 'image/jpeg', 'image/png', 'image/gif']
          })
          .end().find('button[type=reset]').on(ace.click_event, function(){
            $('#user-profile-3 input[type=file]').ace_file_input('reset_input');
          })
          .end().find('.date-picker').datepicker().next().on(ace.click_event, function(){
            $(this).prev().focus();
          })
          $('.input-mask-phone').mask('(999) 999-9999');



          ////////////////////
          //change profile
          $('[data-toggle="buttons"] .btn').on('click', function(e){
            var target = $(this).find('input[type=radio]');
            var which = parseInt(target.val());
            $('.user-profile').parent().addClass('hide');
            $('#user-profile-'+which).parent().removeClass('hide');
          });
        });


      });
    </script>
    <!-- basic scripts -->

    <!--[if !IE]> -->
    <!-- by gll
    <script type="text/javascript">
      window.jQuery || document.write("<script src='../static/js/jquery.min.js'>"+"<"+"/script>");
      </script>
      -->
      <!-- <![endif]-->
{% endblock %}
